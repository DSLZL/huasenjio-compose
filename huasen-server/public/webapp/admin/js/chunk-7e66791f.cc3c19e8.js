(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7e66791f"],{"016b":function(t,e,a){"use strict";a.r(e);a("14d9");var l=a("2f62"),r=a("9ff0");const i=new(a("dabc").b),o=i.getElementFormValidator.bind(i);var s={name:"Public",components:{MarkdownEditor:r.a},data:()=>({articleForm:{manageId:"",title:"",tag:"",content:"",bannerImg:"",code:0,isDraft:!1},rules:{title:[{validator:o(["isNonEmpty::必填项","minLength:2::标题长度不小于2","maxLength:20::标题长度不大于20"])}],manageId:[{validator:o(["isNonEmpty::必填项"])}]},tags:[],tagItem:""}),watch:{tags:{handler(t,e){let a=this.tags.join("/");this.articleForm.tag=a},deep:!0}},computed:{...Object(l.d)(["manage"]),headers(){return{token:this.manage.token}},action(){return this.TOOL.getServerApi("/file/upload")},uploadStyle(){return{"--bannerImg":`url(${this.articleForm.bannerImg})`}}},activated(){this.initSubmitForm()},methods:{initSubmitForm(){this.$nextTick(async()=>{if(0!==Object.keys(this.$route.query).length){let t=(await this.API.article.findArticleById({_id:this.$route.query._id},{notify:!1})).data.pop();t?(this.articleForm=t,this.tags=this.articleForm.tag?this.articleForm.tag.split("/"):[]):this.$router.go(-1)}this.articleForm.manageId=this.manage.id})},handleTag(){this.tagItem&&(this.tags.push(this.tagItem.trim()),this.tagItem="")},deleteTag(t){this.tags.splice(t,1)},cancel(){this.$router.go(-1)},uploadImgSuccess(t){if(200==t.code){let e=t.data.pop();this.articleForm.bannerImg=e.path,this.$tips("success","上传封面成功","top-right")}},uploadImgError(t){this.$tips("error","上传封面失败","top-right")},submit(){this.$refs.articleForm.validate(t=>{t&&(this.articleForm._id?this.API.article.updateArticle(this.articleForm).then(t=>{this.$router.go(-1)}):this.API.article.addArticle(this.articleForm).then(t=>{this.$router.push("/article-manage")}))})},handleSave(){},async handleImgAddUrl(t,e){let a=new FormData;a.append("file",e);let l=await this.API.file.uploadFile(a,{url:"/file/upload?type=article"});return this.$tips("success","上传成功","top-right",1200),location.origin+location.pathname+l.data[0].path}}},n=(a("2f5a"),a("2877")),c=Object(n.a)(s,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"public"},[e("el-form",{ref:"articleForm",staticClass:"article-form-group",attrs:{model:t.articleForm,rules:t.rules,"label-position":"top","status-icon":""}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.articleForm.title,callback:function(e){t.$set(t.articleForm,"title",e)},expression:"articleForm.title"}})],1),e("el-form-item",{attrs:{label:"封面链接",prop:"bannerImg"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.articleForm.bannerImg,callback:function(e){t.$set(t.articleForm,"bannerImg",e)},expression:"articleForm.bannerImg"}})],1),e("el-form-item",{attrs:{label:"发布作者",prop:"manageId"}},[e("el-input",{attrs:{disabled:"",autocomplete:"off"},model:{value:t.articleForm.manageId,callback:function(e){t.$set(t.articleForm,"manageId",e)},expression:"articleForm.manageId"}})],1),e("el-form-item",{attrs:{label:"内容标签",prop:"tag"}},[e("ul",{staticClass:"tag-group"},t._l(t.tags,(function(a,l){return e("li",{directives:[{name:"randomColor",rawName:"v-randomColor",value:{forText:!0},expression:"{ forText: true }"}],key:l},[t._v(" "+t._s(a)+" "),a?e("i",{staticClass:"iconfont icon-md-close-circle",on:{click:function(e){return t.deleteTag(l)}}}):t._e()])})),0),e("el-input",{attrs:{autocomplete:"off",placeholder:"回车添加标签"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleTag.apply(null,arguments)}},model:{value:t.tagItem,callback:function(e){t.tagItem=e},expression:"tagItem"}})],1),e("el-form-item",{attrs:{label:"访问权限",prop:"code"}},[e("el-select",{staticClass:"w-full",attrs:{"popper-class":"code-select","popper-append-to-body":!1},model:{value:t.articleForm.code,callback:function(e){t.$set(t.articleForm,"code",e)},expression:"articleForm.code"}},t._l(this.CONSTANT.dictionary.code,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"是否草稿",prop:"isDraft"}},[e("el-select",{staticClass:"w-full",attrs:{"popper-class":"draft-select","popper-append-to-body":!1},model:{value:t.articleForm.isDraft,callback:function(e){t.$set(t.articleForm,"isDraft",e)},expression:"articleForm.isDraft"}},t._l(this.CONSTANT.dictionary.draft,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),e("MarkdownEditor",{attrs:{value:t.articleForm.content,onImgAdd:t.handleImgAddUrl},on:{"update:value":function(e){return t.$set(t.articleForm,"content",e)},onSave:t.handleSave}}),e("div",{staticClass:"upload-img-group"},[e("el-upload",{staticClass:"upload-box",style:t.uploadStyle,attrs:{headers:t.headers,action:t.action,"on-error":t.uploadImgError,"on-success":t.uploadImgSuccess,accept:".png",drag:""}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("拖拽上传 · "),e("em",[t._v("点击上传")])])])],1),e("div",{staticClass:"submit-group"},[e("div",{staticClass:"btn-group ml-auto"},[e("el-button",{attrs:{type:"primary"},on:{click:t.cancel}},[t._v("取消发布")]),e("el-button",{attrs:{type:"danger"},on:{click:t.submit}},[t._v(" "+t._s(this.articleForm._id?"完成编辑":"立即发布")+" ")])],1)])],1)}),[],!1,null,"299c35ce",null);e.default=c.exports},"2f5a":function(t,e,a){"use strict";a("6d4f")},"6d4f":function(t,e,a){},"829d":function(t,e,a){"use strict";a("a727")},"9ff0":function(t,e,a){"use strict";var l=a("b2d8"),r=(a("64e1"),{name:"MarkdownEditor",data:()=>({toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,table:!0,ol:!0,ul:!0,link:!0,imagelink:!0,help:!1,code:!0,subfield:!0,fullscreen:!0,readmodel:!0,undo:!0,shortCut:!1,trash:!0,autofocus:!1,save:!1,navigation:!0},prop:{subfield:!0,defaultOpen:"preview",editable:!1,toolbarsFlag:!1,scrollStyle:!0}}),props:{value:{type:String,default:""},placeholder:{type:String,default:"请输入..."},onImgAdd:{type:Function}},computed:{valueCP:{get(){return this.value},set(t){this.$emit("update:value",t)}}},components:{mavonEditor:l.mavonEditor},methods:{save(t,e){this.$emit("onSave")},change(){this.$emit("change")},async handleImgAdd(t,e){let a=await this.onImgAdd(t,e);this.$refs.mavonEditor.$img2Url(t,a)}}}),i=(a("829d"),a("2877")),o=Object(i.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"h-markdown-editor"},[e("mavon-editor",{ref:"mavonEditor",staticClass:"markdown-editor",attrs:{placeholder:t.placeholder,toolbars:this.toolbars,scrollStyle:!0,transition:!0,editable:!0,ishljs:!0,tabSize:2},on:{save:t.save,change:t.change,imgAdd:t.handleImgAdd},model:{value:t.valueCP,callback:function(e){t.valueCP=e},expression:"valueCP"}})],1)}),[],!1,null,"2b6b6916",null);e.a=o.exports},a727:function(t,e,a){}}]);
//# sourceMappingURL=chunk-7e66791f.cc3c19e8.js.map