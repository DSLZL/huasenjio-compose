(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2ac49344"],{cd83:function(t,e,a){},e650:function(t,e,a){"use strict";a("cd83")},f6af:function(t,e,a){"use strict";a.r(e);a("14d9"),a("0643"),a("fffc"),a("4e3e"),a("a573");var i=a("ca7f"),o=a("102f");const n=new(a("dabc").a),s=n.getElementFormValidator.bind(n);var l={name:"SiteManage",components:{TableList:i.a,DialogForm:o.a},data(){return{total:0,tableData:[],tableMap:[{label:"网站名称",key:"name"},{label:"网站链接",key:"url"},{label:"网站描述",key:"description"},{label:"网站图标",key:"icon",width:100},{label:"备注",key:"remarks"},{label:"拓展字段",key:"expand"},{label:"权限码",key:"code"},{label:"是否可用",key:"enabled"}],searchForm:{name:"",code:"",tag:""},searchFormMap:[{label:"名称",type:"input",key:"name"},{label:"标签",type:"input",key:"tag"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code}],show:!1,showImport:!1,mode:"add",importMode:"add",formMap:[{label:"名称",key:"name",type:"input"},{label:"链接",key:"url",type:"input"},{label:"图标",key:"icon",type:"icon"},{label:"描述",key:"description",type:"input"},{label:"网站标签",key:"siteTag",type:"select",selectOptions:[],selectConfig:{"allow-create":!0,filterable:!0,multiple:!0}},{label:"置顶标记",key:"sitePin",type:"select",selectOptions:this.CONSTANT.dictionary.pin,selectConfig:{filterable:!0,multiple:!0}},{label:"所属栏目",key:"columnId",type:"select",selectOptions:[],selectConfig:{"allow-create":!0,filterable:!0,multiple:!0}},{label:"备注",key:"remarks",type:"input"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code},{label:"是否可用",key:"enabled",type:"switch"}],importFormMap:[{label:"所属栏目",key:"columnId",type:"select",selectOptions:[],selectConfig:{filterable:!0,multiple:!0}},{label:"操作类型",key:"siteInOut",type:"siteInOut"}],rule:{name:[{validator:s(["isNonEmpty::必填项","minLength:2::长度不能小于2","maxLength:20::长度不能大于20"])}],url:[{validator:s(["isNonEmpty::必填项","isUrl::请输入正确的网址"])}],expand:[{validator:s(["isNonEmpty::必填项","isJSONObject::请输入JSON对象"])}]},importRule:{},form:{name:"",url:"",icon:"",description:"",remarks:"",expand:"{}",enabled:!0,code:0,siteTag:[],sitePin:[],columnId:[]},importForm:{siteTag:[],columnId:[]},initForm:null,pageNo:1,pageSize:10,siteTagNameOptions:[],columnOptions:[]}},mounted(){this.queryData(),this.queryColumnData()},methods:{queryData(){let t=Object.assign({pageNo:this.pageNo,pageSize:this.pageSize},this.searchForm);this.API.site.findSiteByPage(t,{notify:!1}).then(t=>{this.tableData=t.data.list,this.total=t.data.total,this.cancel()}),this.API.site.findSiteTagByList({},{notify:!1}).then(t=>{let e=this.formMap.find(t=>"siteTag"===t.key),a=this.importFormMap.find(t=>"siteTag"===t.key);this.siteTagNameOptions=t.data.map(t=>({label:t,value:t})),e&&(e.selectOptions=[...this.siteTagNameOptions]),a&&(a.selectOptions=[...this.siteTagNameOptions])})},queryColumnData(){this.API.column.findColumnByList({},{notify:!1}).then(t=>{this.columnOptions=t.data.map(t=>({label:t.name,value:t._id}));let e=this.importFormMap.find(t=>"columnId"===t.key),a=this.formMap.find(t=>"columnId"===t.key);e&&(e.selectOptions=[...this.columnOptions]),a&&(a.selectOptions=[...this.columnOptions])})},updatePagination(t,e){this.pageNo=t,this.pageSize=e},handleRemove(t,e){this.API.site.removeSite({_id:e._id}).then(t=>{this.queryData()})},handleRemoveMany(t){let e=t.map(t=>t._id);this.API.site.removeManySite({_ids:e}).then(t=>{this.queryData()})},handleAdd(){this.show=!0,this.mode="add",this.$nextTick(()=>{this.initForm=this.LODASH.cloneDeep(this.form)})},handleAddMany(){this.showImport=!0},handleEdit(t,e){this.show=!0,this.mode="edit",this.$nextTick(async()=>{let t=[],a=[],i=[];try{let o=JSON.parse(e.expand||"{}");t=o.tag||[],a=o.pin||[],i=(await this.API.site.findSiteColmunByList({siteId:e._id},{notify:!1})).data||[]}catch(t){this.$tips("error","初始化编辑数据异常","top-right",2e3)}this.form=Object.assign(this.form,e,{siteTag:t,sitePin:a,columnId:i}),this.initForm=this.LODASH.cloneDeep(this.form)})},paginationChange(){this.queryData()},async save(t){let e={...this.form},a=[],i=[],o=[],n=[];if(this.initForm.columnId.forEach(t=>{-1===e.columnId.indexOf(t)&&a.push(t)}),e.columnId.forEach((t,a)=>{if(-1===this.initForm.columnId.indexOf(t)){this.columnOptions.find(e=>e.value===t)?i.push(t):(o.push({name:t}),e.columnId.splice(a,1))}}),o.length){n=(await this.API.column.addColumn({data:o},{notify:!1})).data.map(t=>t._id)}let s=JSON.parse(e.expand);s="[object Object]"===Object.prototype.toString.call(s)?s:{},s.tag=e.siteTag,s.pin=e.sitePin,s.columnStore=e.columnId.concat(n);let l=JSON.stringify(s);e.expand=l;let d=[];if("edit"===this.mode)await this.API.site.updateSite(e),d.push(e._id);else if("add"===this.mode){delete e._id,delete e._v;let t=await this.API.site.addSite(e);d.push(t.data[0]._id)}let m=i.concat(n);m.length&&await this.API.column.bindSiteToColumn({columnIds:m,siteIds:d},{notify:!1}),a.length&&await this.API.column.unbindSiteToColumn({columnIds:a,siteIds:d},{notify:!1}),this.queryColumnData(),this.queryData()},cancel(){this.$refs.dialogForm&&this.$refs.dialogForm.close(),this.show=!1,this.initForm=null}}},d=(a("e650"),a("2877")),m=Object(d.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"site-manage"},[e("TableList",{attrs:{tableData:t.tableData,tableMap:t.tableMap,formData:t.searchForm,formMap:t.searchFormMap,total:t.total,showAdd:!0,showAddMany:!0,showSelection:!0},on:{"update:formData":function(e){t.searchForm=e},"update:form-data":function(e){t.searchForm=e},edit:t.handleEdit,add:t.handleAdd,addMany:t.handleAddMany,remove:t.handleRemove,removeMany:t.handleRemoveMany,search:t.queryData,paginationChange:t.paginationChange,updatePagination:t.updatePagination}}),t.show?e("DialogForm",{ref:"dialogForm",attrs:{width:"520",maxHeight:"480",title:"add"==t.mode?"添加网链":"编辑网链",visible:t.show,formMap:t.formMap,formData:t.form,formRule:t.rule,"close-on-click-modal":!1,mode:t.mode,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(e){t.show=e},"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e},comfirmForm:t.save,cancelForm:t.cancel},scopedSlots:t._u([{key:"tips",fn:function(){return[e("div",{staticClass:"text text-gray-500"},[e("i",{staticClass:"el-icon-warning-outline text-orange-400 mr-px-4"}),t._v(" 温馨提示：添加的"),e("font",{staticClass:"text-red-400"},[t._v("网链")]),t._v("需要配置绑定到"),e("font",{staticClass:"text-red-400"},[t._v("栏目")]),t._v("后才会被加载显示 ")],1)]},proxy:!0}],null,!1,2560858463)}):t._e(),t.showImport?e("DialogForm",{ref:"dialogImportForm",attrs:{width:"420",maxHeight:"480",title:"链接导入/出",visible:t.showImport,formMap:t.importFormMap,formData:t.importForm,formRule:t.importRule,"close-on-click-modal":!1,mode:t.importMode},on:{"update:visible":function(e){t.showImport=e},"update:formData":function(e){t.importForm=e},"update:form-data":function(e){t.importForm=e}}}):t._e()],1)}),[],!1,null,"f505f580",null);e.default=m.exports}}]);
//# sourceMappingURL=chunk-2ac49344.9cce1cc8.js.map