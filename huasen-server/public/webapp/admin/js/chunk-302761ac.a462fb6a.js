(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-302761ac","chunk-268fffd2"],{"15f6":function(e,t,a){"use strict";a.r(t);a("14d9"),a("e9f5"),a("910d"),a("7d54"),a("ab43"),a("a732");var i=a("b76a"),s=a.n(i),l={name:"SiteSelector",components:{HsDrawer:a("1feb").a,Draggable:s.a},props:{currentColumn:{type:Object,default:()=>{}}},data:()=>({searchText:"",searchType:"siteName",selectSites:[],selectSiteIndex:[],sites:[],preSelectSiteIndex:[]}),computed:{displaySites(){return"tag"===this.searchType?this.searchText?this.sites.filter(e=>{if(e.expand&&"{}"!==e.expand)try{return JSON.parse(e.expand).tag.some(t=>{if(t.toUpperCase().includes(this.searchText.toUpperCase()))return e.targetTagName=t,!0})}catch{console.log("标签筛选异常")}}):this.sites:this.sites.filter(e=>e.name.toUpperCase().includes(this.searchText.toUpperCase()))},searchPlaceholderText(){return"请输入"+("tag"===this.searchType?"标签":"网站")+"名称"},showTag(){return this.searchText&&"tag"===this.searchType}},watch:{selectSiteIndex(){this.handleSelectSite()},sites(){this.handleSelectSite()},currentColumn:{handler(e,t){try{this.selectSiteIndex=Array.isArray(JSON.parse(e.siteStore))?[...JSON.parse(e.siteStore)]:[],this.preSelectSiteIndex=[...this.selectSiteIndex]}catch(e){this.selectSiteIndex=[]}},deep:!0,immediate:!0}},mounted(){this.querySite()},methods:{querySite(){this.API.site.findSiteByList({},{notify:!1}).then(e=>{this.sites=e.data})},handleSelectSite(){let e=[];this.selectSiteIndex.forEach(t=>{this.sites.some(a=>{if(a._id===t)return e.push(a),!0})}),this.selectSites=e},getSelectStatus(e){return this.selectSiteIndex.includes(e._id)},imgUrl:e=>e.icon?e.icon:a("4101"),selectSite(e){let{_id:t}=e,a=this.selectSiteIndex.indexOf(t);-1===a?this.selectSiteIndex.push(t):this.selectSiteIndex.splice(a,1)},async save(){let e=[],t=[];t=this.preSelectSiteIndex.filter(e=>-1===this.selectSiteIndex.indexOf(e)),e=this.selectSiteIndex.filter(e=>-1===this.preSelectSiteIndex.indexOf(e));let a=this.selectSites.map(e=>e._id);await this.API.column.updateColumn({_id:this.currentColumn._id,siteStore:JSON.stringify(a)}),e.length&&await this.API.site.bindColumnToSite({columnId:this.currentColumn._id,sites:e},{notify:!1}),t.length&&await this.API.site.unbindColumnToSite({columnId:this.currentColumn._id,sites:t},{notify:!1}),this.$emit("save")},cancel(){this.$emit("cancel"),this.$emit("update:visible",!1)},remove(e,t){let a=this.selectSiteIndex.indexOf(e._id);-1!==a&&this.selectSiteIndex.splice(a,1)}}},n=(a("7a9a"),a("2877")),r=Object(n.a)(l,(function(){var e=this,t=e._self._c;return t("HsDrawer",e._g(e._b({},"HsDrawer",e.$attrs,!1),e.$listeners),[t("div",{staticClass:"site-selector"},[t("div",{staticClass:"site-selector-main"},[t("div",{staticClass:"selected"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[e._v("已选择")])]),t("ul",{staticClass:"site-list"},[t("Draggable",{attrs:{filter:".no-drap",animation:"400"},model:{value:e.selectSites,callback:function(t){e.selectSites=t},expression:"selectSites"}},[t("transition-group",e._l(e.selectSites,(function(a,i){return t("li",{key:a._id,staticClass:"site-item drag-item"},[t("i",{staticClass:"el-icon-rank pointer"}),t("div",{staticClass:"name text no-drap"},[e._v(e._s(e._f("emptyTip")(a.name)))]),t("div",{staticClass:"description text no-drap"},[e._v(e._s(e._f("emptyTip")(a.description)))]),t("i",{staticClass:"el-icon-delete pointer remove no-drap",on:{click:function(t){return e.remove(a,i)}}})])})),0)],1)],1)]),t("div",{staticClass:"selecting"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[e._v("待选择")]),t("div",{staticClass:"search"},[t("el-select",{model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[t("el-option",{attrs:{label:"标签名",value:"tag"}}),t("el-option",{attrs:{label:"网站名",value:"siteName"}})],1),t("el-input",{attrs:{placeholder:e.searchPlaceholderText,"suffix-icon":"el-icon-search"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1)]),t("ul",{staticClass:"site-group"},e._l(e.displaySites,(function(a){return t("li",{key:a._id,staticClass:"site",class:{active:e.getSelectStatus(a)},on:{click:function(t){return e.selectSite(a)}}},[t("div",{staticClass:"icon-group"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy"}],attrs:{src:e.imgUrl(a)}})]),t("div",{staticClass:"text-group"},[t("div",{staticClass:"name text",attrs:{title:a.name}},[e._v(e._s(e._f("emptyTip")(a.name)))]),t("div",{staticClass:"description text",attrs:{title:a.description}},[e._v(e._s(e._f("emptyTip")(e.showTag?a.targetTagName:a.description)))])])])})),0)])]),t("div",{staticClass:"site-selector-footer"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.save}},[e._v("确定配置")]),t("el-button",{attrs:{type:"warning",plain:""},on:{click:e.cancel}},[e._v("取消修改")])],1)])])}),[],!1,null,"7bf9506f",null);t.default=r.exports},3132:function(e,t,a){},"57c3":function(e,t,a){"use strict";a.r(t);var i=a("ca7f"),s=a("102f"),l=a("15f6");const n=new(a("dabc").a),r=n.getElementFormValidator.bind(n);var o={name:"ColumnManage",components:{TableList:i.a,DialogForm:s.a,SiteSelector:l.default},data(){return{total:0,tableData:[],tableMap:[{label:"栏目名称",key:"name"},{label:"描述",key:"description"},{label:"封面",key:"banner"},{label:"权限码",key:"code"},{label:"是否可用",key:"enabled"},{label:"备注",key:"remarks"},{label:"网址仓库",key:"siteStore"},{label:"拓展字段",key:"expand"}],searchForm:{name:"",code:""},searchFormMap:[{label:"名称",type:"input",key:"name"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code}],show:!1,showSiteSelector:!1,mode:"add",formMap:[{label:"名称",key:"name",type:"input"},{label:"描述",key:"description",type:"input"},{label:"备注",key:"remarks",type:"input"},{label:"封面",key:"banner",type:"banner"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code},{label:"是否可用",key:"enabled",type:"switch"}],rule:{name:[{validator:r(["isNonEmpty::必填项","minLength:2::长度不能小于2","maxLength:20::长度不能大于20"])}],url:[{validator:r(["isNonEmpty::必填项","isUrl::请输入正确的网址"])}],siteStore:[{validator:r(["isJSONArray::请输入JSON数组"])}],expand:[{validator:r(["isJSONObject::请输入JSON对象"])}]},form:{name:"",siteStore:"[]",description:"",banner:"",remarks:"",expand:"{}",enabled:!0,code:0},currentColumn:{},pageNo:1,pageSize:10}},mounted(){this.queryData()},methods:{queryData(){let e=Object.assign({pageNo:this.pageNo,pageSize:this.pageSize},this.searchForm);this.API.column.findColumnByPage(e,{notify:!1}).then(e=>{this.tableData=e.data.list,this.total=e.data.total,this.cancel()})},updatePagination(e,t){this.pageNo=e,this.pageSize=t},handleRemove(e,t,a,i){this.API.column.removeColumn({_id:t._id}).then(e=>{this.queryData()})},handleAdd(){this.show=!0,this.mode="add"},handleEdit(e,t){this.show=!0,this.mode="edit",this.$nextTick(()=>{this.form=Object.assign(this.form,t)})},handleRelation(e,t){this.showSiteSelector=!0,this.currentColumn={...t}},paginationChange(){this.queryData()},save(){"edit"===this.mode?this.API.column.updateColumn(this.form).then(e=>{this.queryData()}):"add"===this.mode&&(delete this.form._id,delete this.form._v,this.API.column.addColumn({data:this.form}).then(e=>{this.queryData()}))},handleColumnSave(){this.showSiteSelector=!1,this.queryData()},cancel(){this.$refs.dialogForm&&this.$refs.dialogForm.close(),this.show=!1}}},c=(a("ff58"),a("2877")),d=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"column-manage"},[t("TableList",{attrs:{tableData:e.tableData,tableMap:e.tableMap,formData:e.searchForm,formMap:e.searchFormMap,total:e.total,showAdd:!0,showRelation:!0},on:{"update:formData":function(t){e.searchForm=t},"update:form-data":function(t){e.searchForm=t},relation:e.handleRelation,edit:e.handleEdit,add:e.handleAdd,remove:e.handleRemove,search:e.queryData,paginationChange:e.paginationChange,updatePagination:e.updatePagination}}),e.show?t("DialogForm",{ref:"dialogForm",attrs:{width:"460",title:"add"==e.mode?"添加栏目":"编辑栏目",visible:e.show,formMap:e.formMap,formData:e.form,formRule:e.rule,mode:e.mode,"close-on-click-modal":!1,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(t){e.show=t},"update:formData":function(t){e.form=t},"update:form-data":function(t){e.form=t},comfirmForm:e.save,cancelForm:e.cancel},scopedSlots:e._u([{key:"tips",fn:function(){return[t("div",{staticClass:"text text-gray-500"},[t("i",{staticClass:"el-icon-warning-outline text-orange-400"}),e._v(" 温馨提示：添加的"),t("font",{staticClass:"text-red-400"},[e._v("栏目")]),e._v("需要配置关联到"),t("font",{staticClass:"text-red-400"},[e._v("订阅源")]),e._v("后才会被加载显示 ")],1)]},proxy:!0}],null,!1,1187273032)}):e._e(),e.showSiteSelector?t("SiteSelector",{attrs:{title:"配置栏目",size:"500",visible:e.showSiteSelector,wrapperClosable:!1,currentColumn:e.currentColumn},on:{"update:visible":function(t){e.showSiteSelector=t},save:e.handleColumnSave}}):e._e()],1)}),[],!1,null,"040da5d6",null);t.default=d.exports},"7a9a":function(e,t,a){"use strict";a("b1bb")},b1bb:function(e,t,a){},ff58:function(e,t,a){"use strict";a("3132")}}]);
//# sourceMappingURL=chunk-302761ac.a462fb6a.js.map